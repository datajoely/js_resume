name: Build and Deploy Resume to GitHub Pages
on:
  push:
    branches:
      - main
  workflow_dispatch: # Allow manual triggering

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-page:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Debug environment
        run: |
          echo "Current working directory: $(pwd)"
          echo "Directory contents:"
          ls -la
          echo "Node version: $(node --version)"
          echo "NPM version: $(npm --version)"
      
      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest
      
      - name: Setup dependencies
        run: make setup
      
      - name: Build resume HTML
        run: |
          echo "Building resume HTML..."
          make build
          echo "Build completed. Checking output..."
      
      - name: Generate PDF (optional)
        run: |
          echo "Generating PDF..."
          make pdf
          echo "PDF generation completed."
      
      - name: Verify build output
        run: |
          echo "Checking if docs/index.html was created:"
          ls -la docs/
          echo "Checking HTML content (first few lines):"
          head -20 docs/index.html
          echo "Checking if Google Analytics is included:"
          grep -i "gtag" docs/index.html || echo "Google Analytics not found in HTML"
          echo "Checking PDF file:"
          ls -la docs/resume.pdf
          echo "PDF file size: $(stat -c%s docs/resume.pdf) bytes"
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./docs
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
